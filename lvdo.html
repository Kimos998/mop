<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Note Remboursement / En cours / Suivi Livraison</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/lucide-static@latest/font/lucide.css" rel="stylesheet">
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --primary-light: #60a5fa;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-500: #6b7280;
      --gray-700: #374151;
      --gray-900: #111827;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --radius-sm: 8px;
      --radius: 12px;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
      --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
      --transition: all 0.2s ease;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--gray-50);
      color: var(--gray-900);
      min-height: 100vh;
      line-height: 1.6;
    }
    .container {
      max-width: 820px;
      margin: 1.5rem auto;
      padding: 0 1rem;
    }
    .nav {
      display: flex;
      background: white;
      border-radius: var(--radius);
      border: 1px solid var(--gray-200);
      padding: 0.5rem;
      margin-bottom: 1.75rem;
      box-shadow: var(--shadow-sm);
      overflow: hidden;
    }
    .nav button {
      flex: 1;
      padding: 0.85rem;
      border: none;
      background: transparent;
      font-weight: 500;
      color: var(--gray-500);
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.95rem;
      border-radius: var(--radius);
    }
    .nav button.active {
      background: var(--primary);
      color: white;
      font-weight: 600;
    }
    .nav button:hover:not(.active) {
      background: var(--gray-100);
      color: var(--gray-700);
    }
    .card {
      background: white;
      border-radius: var(--radius);
      border: 1px solid var(--gray-200);
      padding: 1.5rem;
      box-shadow: var(--shadow);
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      margin-bottom: 1.25rem;
    }
    .form-row label {
      min-width: 140px;
      font-weight: 500;
      color: var(--gray-700);
    }
    .form-row input,
    .form-row select,
    .form-row textarea {
      flex: 1;
      min-width: 180px;
      padding: 0.75rem 1rem;
      border: 1px solid var(--gray-300);
      border-radius: var(--radius);
      font-size: 0.95rem;
      transition: var(--transition);
    }
    .form-row input:focus,
    .form-row select:focus,
    .form-row textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59,130,246,0.15);
    }
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .checkbox-group input[type="checkbox"] {
      width: 1.1rem;
      height: 1.1rem;
      accent-color: var(--primary);
    }
    #note-area {
      width: 100%;
      min-height: 180px;
      padding: 1rem;
      border: 1px solid var(--gray-300);
      border-radius: var(--radius);
      font-family: 'Courier New', monospace;
      font-size: 0.95rem;
      background: var(--gray-50);
      resize: vertical;
      margin: 1.5rem 0;
      white-space: pre-wrap;
    }
    .note-extra {
      background: var(--gray-50);
      border: 1px solid var(--gray-200);
      border-radius: var(--radius);
      padding: 1rem;
      margin: 1rem 0;
      position: relative;
    }
    .note-extra pre {
      margin: 0;
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      font-size: 0.92rem;
      color: var(--gray-700);
    }
    .btn {
      padding: 0.7rem 1.3rem;
      border-radius: var(--radius);
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: var(--transition);
      font-size: 0.95rem;
      border: none;
    }
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    .btn-primary:hover {
      background: var(--primary-dark);
    }
    .btn-outline {
      background: white;
      border: 1px solid var(--gray-300);
      color: var(--gray-700);
    }
    .btn-outline:hover {
      border-color: var(--primary);
      color: var(--primary);
      background: rgba(59,130,246,0.04);
    }
    .copy-extra-btn {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
    }
    .copy-container {
      text-align: right;
      margin-top: 1rem;
    }
    .toast-container {
      position: fixed;
      top: 1.25rem;
      right: 1.25rem;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .toast {
      background: var(--gray-900);
      color: white;
      padding: 0.9rem 1.4rem;
      border-radius: var(--radius);
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 0.6rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.5s forwards;
    }
    @keyframes slideIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes fadeOut { to { opacity: 0; transform: translateY(-12px); } }

    /* زر جانبي بسيط + قائمة فاتحة */
    .side-quick-btn {
      position: fixed;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      width: 48px;
      height: 48px;
      background: rgba(100, 116, 139, 0.22);
      color: #475569;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      font-weight: 500;
      cursor: pointer;
      z-index: 800;
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      transition: all 0.22s ease;
      opacity: 0.65;
    }

    .side-quick-btn:hover {
      background: rgba(100, 116, 139, 0.38);
      opacity: 1;
      transform: translateY(-50%) scale(1.08);
    }

    .side-quick-panel {
      position: fixed;
      right: -240px;
      top: 0;
      width: 220px;
      height: 100%;
      background: #f8fafc;
      border-left: 1px solid #e2e8f0;
      transition: right 0.28s ease;
      z-index: 780;
      padding: 3rem 0.8rem 1.2rem;
      color: #1e293b;
    }

    .side-quick-panel.open {
      right: 0;
    }

    .panel-item {
      display: block;
      padding: 0.9rem 1.1rem;
      color: #334155;
      text-decoration: none;
      font-size: 1.02rem;
      border-radius: 8px;
      margin: 0.4rem 0;
      transition: all 0.18s ease;
    }

    .panel-item:hover {
      background: #f1f5f9;
      color: #0f172a;
      padding-left: 1.4rem;
    }

    .side-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.25);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.28s ease;
      z-index: 770;
    }

    .side-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    @media (max-width: 640px) {
      .form-row { flex-direction: column; align-items: stretch; }
      .form-row label { min-width: auto; }
      .nav button { font-size: 0.9rem; padding: 0.75rem; }
      .container { padding: 1rem 0.75rem; }
      .side-quick-btn { width: 44px; height: 44px; font-size: 24px; right: 12px; }
      .side-quick-panel { width: 200px; }
    }
  </style>
</head>
<body>

<!-- زر جانبي بسيط + قائمة بدون عنوان -->
<div class="side-quick-btn" id="sideQuickBtn">⋮</div>

<div class="side-quick-panel" id="sideQuickPanel">
   <a href="lvdo.html"  class="panel-item">RBT / Liv apres</a>
  <a href="do.html" class="panel-item">Dossier</a>
  <a href="rec.html" class="panel-item">Rec</a>
  <a href="sav.html"  class="panel-item">SAV</a>
  <a href="esc.html"  class="panel-item">Esc</a>
  <a href="nb.html" class="panel-item">remarques</a>
</div>

<div class="side-overlay" id="sideOverlay"></div>

<div class="container">
  <div class="toast-container" id="toasts"></div>

  <nav class="nav">
    <button class="active" data-mode="remboursement"><i class="icon-check-circle"></i> Remboursement validé</button>
    <button data-mode="encours"><i class="icon-clock"></i> Cas en cours</button>
    <button data-mode="suivi"><i class="icon-truck"></i> Suivi livraison</button>
  </nav>

  <div class="card">
    <!-- Remboursement -->
    <div id="remb_section">
      <div class="form-row">
        <label>Genre :</label>
        <select id="genre">
          <option value="inconnu">Inconnu / Neutre</option>
          <option value="homme">Homme</option>
          <option value="femme">Femme</option>
        </select>
      </div>
      <div class="form-row">
        <label>Montant :</label>
        <input type="number" step="0.01" id="montant" value="212">
        <span style="margin-left:0.5rem; color:var(--gray-700);">€</span>
      </div>
      <div class="form-row">
        <label>Mensualités :</label>
        <select id="mensualites">
          <option value="0">Aucune</option>
          <option value="1">1 restante</option>
          <option value="2">2 restantes</option>
          <option value="3">3 restantes</option>
        </select>
      </div>
      <div class="form-row checkbox-group">
        <input type="checkbox" id="boa">
        <label for="boa">Réactiver BOA</label>
      </div>
      <div class="form-row checkbox-group">
        <input type="checkbox" id="geste">
        <label for="geste">Geste commercial</label>
        <input type="number" step="0.01" id="geste_montant" placeholder="ex: 20" style="width:100px; display:none;">
        <span id="geste_unit" style="display:none; margin-left:0.5rem;">€</span>
      </div>
      <div class="form-row checkbox-group">
        <input type="checkbox" id="refus_livraison">
        <label for="refus_livraison">Conseiller de refuser la livraison</label>
      </div>
    </div>

    <!-- En cours -->
    <div id="encours_section" style="display:none;">
      <div class="form-row">
        <label>Numéro de dossier :</label>
        <input type="text" id="num_dossier" placeholder="ex: 120856897">
      </div>
      <div class="note-extra">
        <button class="btn btn-outline copy-extra-btn" data-target="reclamation-passee">
          <i class="icon-copy"></i> Copier
        </button>
        <pre id="text-reclamation-passee">La réclamation a déjà été passée dans le dossier n° .</pre>
      </div>
    </div>

    <!-- Suivi livraison -->
    <div id="suivi_section" style="display:none;">
      <div class="form-row">
        <label>Genre :</label>
        <select id="genre_suivi">
          <option value="inconnu">Inconnu / Neutre</option>
          <option value="homme">Homme</option>
          <option value="femme">Femme</option>
        </select>
      </div>
      <div class="form-row">
        <label>Nom du produit :</label>
        <input type="text" id="produit" value="Poupée Reborn ZIYIUI en silicone de 55cm">
      </div>
      <div class="form-row">
        <label>Lien de suivi :</label>
        <input type="text" id="lien_suivi" value="https://www.ship24.com/tracking?p=YT2601900709265037">
      </div>
      <div class="note-extra">
        <button class="btn btn-outline copy-extra-btn" data-target="info-livraison">
          <i class="icon-copy"></i> Copier
        </button>
        <pre id="text-info-livraison"></pre>
      </div>
      <div class="note-extra">
        <button class="btn btn-outline copy-extra-btn" data-target="attente">
          <i class="icon-copy"></i> Copier
        </button>
        <pre id="text-attente"></pre>
      </div>
    </div>

    <textarea id="note-area" readonly></textarea>

    <div class="copy-container">
      <button class="btn btn-primary" id="copyButton">
        <i class="icon-copy"></i> Copier la note
      </button>
    </div>
  </div>
</div>

<script>
// ────────────────────────────────────────────────
// Toast
// ────────────────────────────────────────────────
function toast(msg, icon = 'icon-check') {
  const t = document.createElement('div');
  t.className = 'toast';
  t.innerHTML = `<i class="${icon}"></i> ${msg}`;
  document.getElementById('toasts').appendChild(t);
  setTimeout(() => t.remove(), 2200);
}

// ────────────────────────────────────────────────
// Mode & Navigation
// ────────────────────────────────────────────────
const navButtons = document.querySelectorAll('.nav button');
navButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    navButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const mode = btn.dataset.mode;
    document.getElementById('remb_section').style.display = mode === 'remboursement' ? 'block' : 'none';
    document.getElementById('encours_section').style.display = mode === 'encours' ? 'block' : 'none';
    document.getElementById('suivi_section').style.display = mode === 'suivi' ? 'block' : 'none';
    updateNote();
  });
});

// ────────────────────────────────────────────────
// Helpers
// ────────────────────────────────────────────────
function formatMontant(val) {
  const num = Number(val);
  if (isNaN(num) || num === 0) return '0';
  return Number.isInteger(num) ? num.toString() : num.toFixed(2).replace('.', ',');
}

function getGenreInfo() {
  const genreSelect = document.querySelector('#suivi_section[style*="block"] #genre_suivi') ||
                      document.querySelector('#remb_section #genre');
  const genre = genreSelect?.value || 'inconnu';
  const isFemale = genre === 'femme';
  return {
    sujet: isFemale ? 'Cliente informée' : 'Client informé',
    pronom: isFemale ? 'la cliente' : 'le client',
    poss: isFemale ? 'sa' : 'son',
    part: isFemale ? 'occasionnée' : 'occasionné',
    accord: isFemale ? 'e' : '',
    invite: isFemale ? 'invitée' : 'invité',
    pronomSujet: isFemale ? 'elle' : 'il',
    pronomSujetAccord: isFemale ? 'recontactée' : 'recontacté'
  };
}

// ────────────────────────────────────────────────
// Mise à jour du contenu
// ────────────────────────────────────────────────
function updateExtraNotes() {
  const g = getGenreInfo();
  if (document.getElementById('suivi_section').style.display !== 'none') {
    document.getElementById('text-info-livraison').textContent =
      `J’ai informé ${g.pronom} que le colis est marqué comme livré depuis le 04/02 et je l’ai ${g.invite} à confirmer la réception de ${g.poss} commande ou, le cas échéant, à contester la livraison.`;
    document.getElementById('text-attente').textContent =
      `Attendre la réponse de ${g.pronom}.`;
  }
  if (document.getElementById('encours_section').style.display !== 'none') {
    const num = document.getElementById('num_dossier').value.trim();
    document.getElementById('text-reclamation-passee').textContent =
      `La réclamation a déjà été passée dans le dossier n° ${num ? num : ''}.`;
  }
}

function updateNote() {
  let text = '';
  const g = getGenreInfo();
  const mode = document.querySelector('.nav button.active')?.dataset.mode || 'remboursement';

  if (mode === 'encours') {
    const num = document.getElementById('num_dossier').value.trim();
    text = `Cas déjà en cours de traitement sur le dossier N°${num ? ' ' + num : ''}.`;
  }
  else if (mode === 'suivi') {
    const produit = document.getElementById('produit').value.trim() || 'produit';
    const lien = document.getElementById('lien_suivi').value.trim() || '';
    text = `Bonjour,\n\nJe vous contacte aujourd’hui concernant la livraison du produit « ${produit} ».\nAprès vérification, la commande est indiquée comme livrée (${lien}).\n\nJe vous contacte donc afin de vous demander de bien vouloir confirmer la réception du produit.\n\nDans le cas contraire, nous effectuerons le nécessaire pour vous proposer une solution.\n\nMerci de bien vouloir nous confirmer la situation directement via cette discussion.\n\nJe reprendrai votre dossier dans deux jours afin de suivre l’avancement et de clôturer cette réclamation ou de mettre en place une solution adaptée.\n\nMerci de votre compréhension.\n\nCordialement,\nAbdelkrim\nL’équipe Cdiscount`;
  }
  else { // remboursement
    const rawMontant = parseFloat(document.getElementById('montant').value) || 0;
    const montant = formatMontant(rawMontant);
    const reste = parseInt(document.getElementById('mensualites').value) || 0;
    const boa = document.getElementById('boa').checked;
    const gesteOn = document.getElementById('geste').checked;
    const gesteRaw = gesteOn ? parseFloat(document.getElementById('geste_montant').value) || 0 : 0;
    const geste = formatMontant(gesteRaw);
    const refusLivraison = document.getElementById('refus_livraison').checked;

    text = `${g.sujet} de ${g.poss} remboursement d'un montant de ${montant} euros qui sera visible sur son compte sous 3 à 5 jours ouvrés`;
    const parties = [];
    if (reste === 1) parties.push("la mensualité restante a été annulée");
    else if (reste > 1) parties.push(`les ${reste} mensualités restantes ont été annulées`);
    if (boa) parties.push("les bons d'achat ont également été réactivés");
    if (gesteOn && gesteRaw > 0) parties.push(`un geste commercial de ${geste} euros a été accordé ${g.pronom} suite à la gêne ${g.part}`);
    if (parties.length) text += " ; " + parties.join(" ; ");
    text += ".";
    if (refusLivraison) {
      text += ` Je lui ai conseillé de refuser la livraison s’${g.pronomSujet} est ${g.pronomSujetAccord} ultérieurement par le transporteur, afin d’éviter tout problème de paiement.`;
    }
  }

  document.getElementById('note-area').value = text.trim();
  updateExtraNotes();
}

// ────────────────────────────────────────────────
// Copy
// ────────────────────────────────────────────────
function copyToClipboard(text, btn) {
  if (!text.trim()) return;
  navigator.clipboard.writeText(text).then(() => {
    const orig = btn.innerHTML;
    btn.innerHTML = '<i class="icon-check"></i> Copié !';
    btn.classList.add('btn-success');
    toast('Copié dans le presse-papiers');
    setTimeout(() => {
      btn.innerHTML = orig;
      btn.classList.remove('btn-success');
    }, 1600);
  }).catch(() => toast('Échec de la copie', 'icon-alert-triangle'));
}

document.getElementById('copyButton').addEventListener('click', () => {
  copyToClipboard(document.getElementById('note-area').value, document.getElementById('copyButton'));
});

document.querySelectorAll('.copy-extra-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const target = btn.dataset.target;
    const el = document.getElementById(`text-${target}`);
    if (el) copyToClipboard(el.textContent, btn);
  });
});

// ────────────────────────────────────────────────
// Listeners
// ────────────────────────────────────────────────
document.querySelectorAll('input, select').forEach(el => {
  el.addEventListener('input', updateNote);
  el.addEventListener('change', updateNote);
});

document.getElementById('geste').addEventListener('change', e => {
  const show = e.target.checked;
  document.getElementById('geste_montant').style.display = show ? 'inline-block' : 'none';
  document.getElementById('geste_unit').style.display = show ? 'inline' : 'none';
  if (show && !document.getElementById('geste_montant').value) {
    document.getElementById('geste_montant').value = '20';
  }
  updateNote();
});

// Init
updateNote();

// ────────────────────────────────────────────────
// زر القائمة الجانبية (التنقل السريع)
// ────────────────────────────────────────────────
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.getElementById('sideQuickBtn');
  const panel = document.getElementById('sideQuickPanel');
  const overlay = document.getElementById('sideOverlay');

  function closePanel() {
    panel.classList.remove('open');
    overlay.classList.remove('open');
  }

  btn.addEventListener('click', () => {
    panel.classList.toggle('open');
    overlay.classList.toggle('open');
  });

  overlay.addEventListener('click', closePanel);

  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') closePanel();
  });
});
</script>
</body>
</html>
